

#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#define PI 3.14159265358979323846

double TOF(double tof0, double Phi0, int n, double varphi[], double fs) {
    
    double dt[n];
    double tof[n];

    dt[0] = Phi0;
    tof[0] = tof0 + dt[0] * (1 / (2 * PI * fs));

    for (int i = 1; i < n; i++) {
        dt[i] = varphi[i] - varphi[i-1];
        if (dt[i] > PI) {
            dt[i] = -1 * copysign(2 * PI - fabs(dt[i]), dt[i]);
        }

        if (dt[i] >= 130.0 / 180.0 * PI || fabs(dt[i]) >= 120.0 / 180.0 * PI) {
            dt[i] = dt[i - 1];
        }

        tof[i] = tof[i - 1] + dt[i] * (1 / (2 * PI * fs));
    }

    printf("Time of flight: %f\n", tof);
    printf("Fase: %f\n", Phi0);

    return tof[0];
}

varphi = {0.413935847974228,
0.452017336094201,
0.380803600096766,
0.414550582698268,
0.397031158422044,
0.432840303522165,
0.381300229173921,
0.387573858581807,
0.349372765762746,
0.344589606615424,
0.385413782187258,
0.368829552222428,
0.371125156248512,
0.441518557612027,
0.345889521890132,
0.370708191601944,
0.303982727595976,
0.401518214856663,
0.325951712069137,
0.326794132922637,
0.341021655944827,
0.373345510842947,
0.404739811950730,
0.442020722012805,
0.642170997486777,
0.412700741722843,
0.449167332098967,
0.375886391580810,
0.364128924726111,
0.320022576134965,
0.600066389290577,
0.424682133444255,
0.439857261700132,
0.310291794410689,
0.372464754385698,
0.533739685546569,
0.455340013303337,
0.483228328515705,
0.487888185569221,
0.572895209026444,
0.466821881040762,
0.412689019233204,
0.430426434279890,
0.488881529177444,
0.456284217167931,
0.425250155466418,
0.336685110102126,
0.409095962223641,
0.380534247846365,
0.422779284143239,
0.315611728482362,
0.346679448446060,
0.420628558112185,
0.335201105633454,
0.381095520253282,
0.342973006622734,
0.631026602111967,
0.420568276681222,
0.446880721645905,
0.383582972943152,
0.394988131625683,
0.566472303280743,
0.276446947192332,
0.436066227009266,
0.375441635451116,
0.395879440930482,
0.483915479652300,
0.321343216920833,
0.338864648706543,
0.305590047425016,
0.299365569706181,
0.442710023666755,
0.397646958784344,
0.470515932889223,
0.454879035921049,
0.392691275063633,
0.475808322240626,
0.476951720776651,
0.484410344177285,
0.453816710367748,
0.371028354636622,
0.451960004568212,
0.541166339614555,
0.533238512104761,
0.465121628384208,
0.468600900984534,
0.649295454506372,
0.398399520407794,
0.403055352601666,
0.417552630492136,
0.283387519861501,
0.289601391933925,
0.294161983565877,
0.417532808887375,
0.429317062600195,
0.427116802516675,
0.387495650298331,
0.355656410603895,
0.352059821139659,
0.361910446739755,
0.292333869129079,
0.396252605259571,
0.397723869359028,
0.285602343785725,
0.373614647787801,
0.405215887545508,
0.393318093158844,
0.368627323289366,
0.370443183327174,
0.408359209583606,
0.358185308592709,
0.416183629495602,
0.400201061210718,
0.397790735918632,
0.405389460534376,
0.643568615903989,
0.414870717245667,
0.384814911095009,
0.377890966565052,
0.428543618773691,
0.341694993218960,
0.365753936508698,
0.408635282598330,
0.513691066757655,
0.456702605880380,
0.461443552188241,
0.444244034526160,
0.458209247066123,
0.430738163927271,
0.426395747233319,
0.345844025459582,
0.385453362280469,
0.455868066419140,
0.391119075582948,
0.406043768383333,
0.352839334906599,
0.345125310025617,
0.399467933267392,
0.347570108091851,
0.378082986416690,
0.609558446407131,
0.409504581452151,
0.390979680993121,
0.404830980010394,
0.444022389977695,
0.324094584882488,
0.287507016338719,
0.363903538751095,
0.328493771134143,
0.348713695641429,
0.405637485855843,
0.430738931855113,
0.468903948644925,
0.445824355750055,
0.448919246539492,
0.440254001308033,
0.510358274929809,
0.421767938775431,
0.335073689426278,
0.368046056302863,
0.393549267961309,
0.453152244285428,
0.455572153053599,
0.488073122061437,
0.549947627300489,
0.507887374851619,
0.522540640535919,
0.450721608380248,
0.511565614196236,
0.538856633657186,
0.503053770758577,
0.533166184560326,
0.583018098645929,
0.560930079262387,
0.532835650472254,
0.576452721815131,
0.468854207292327};





